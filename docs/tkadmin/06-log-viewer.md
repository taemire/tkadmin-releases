# 시스템 로그

## 개요

**시스템 로그** 화면은 tkadmin 애플리케이션의 시스템 로그를 웹 브라우저에서 실시간으로 확인할 수 있는 뷰어입니다. Zap + Lumberjack 기반의 구조화된 JSON 로그를 파싱하여 사람이 읽기 쉬운 테이블 형태로 제공하며, 강력한 필터링과 무한 스크롤을 통해 과거 로그까지 빠르게 탐색할 수 있습니다.



---

## 화면 구성

| 영역 | 설명 |
|------|------|
| **상단 툴바** | 레벨 필터, 검색어 입력, 검색 버튼, 실시간 상태 표시 |
| **로그 테이블** | 시간, 레벨, 메시지, 호출자(Caller) 컬럼으로 구성된 로그 데이터 |

### 테이블 컬럼

| 컬럼 | 설명 | 기본 너비 |
|------|------|----------|
| **확장** | 구조화된 데이터(Fields)가 있는 경우 토글 버튼 표시 | 40px |
| **시간** | 로그 기록 시각 (HH:MM:SS.mmm 형식) | 200px |
| **레벨** | 로그 레벨 뱃지 (INFO, WARN, ERROR, DEBUG) | 80px |
| **메시지** | 로그 본문 내용 | 500px |
| **호출자** | 로그를 기록한 소스 코드 위치 | 160px |

?> **팁**: 컬럼 헤더의 경계선을 **마우스로 드래그**하면 컬럼 너비를 자유롭게 조절할 수 있습니다.

---

## 실시간 로그 추적

### 자동 폴링

시스템 로그 화면에 진입하면 **3초 주기**로 새로운 로그를 자동으로 감지하여 표시합니다.

| 항목 | 값 |
|------|-----|
| **폴링 주기** | 3초 |
| **표시 위치** | 테이블 최상단에 새 로그 삽입 |
| **상태 표시** | 툴바 우측의 초록색 점 + "실시간 업데이트 중" 텍스트 |

### 동작 방식

1. 화면 진입 시 최근 로그 100건을 최초 로드합니다.
2. 이후 3초마다 마지막으로 수신한 로그의 타임스탬프(`lastTs`) 이후의 새 로그만 조회합니다.
3. 새 로그가 발견되면 테이블 최상단에 자동으로 삽입합니다.
4. 다른 메뉴로 이동하면 폴링 타이머가 자동 해제됩니다.

---

## 필터링 기능

### 레벨별 필터

상단 툴바의 드롭다운에서 원하는 로그 레벨을 선택하면, 해당 레벨의 로그만 필터링하여 표시합니다.

| 레벨 | 색상 | 설명 |
|------|------|------|
| **모든 레벨** | - | 필터 없이 전체 로그 표시 (기본값) |
| **INFO** | 파란색 | 일반적인 정보 로그 |
| **WARN** | 노란색 | 경고 수준의 로그 |
| **ERROR** | 빨간색 | 오류 발생 로그 |
| **DEBUG** | 회색 | 디버그 모드 활성 시의 상세 로그 |

?> **팁**: 프로덕션 환경에서는 기본 로그 레벨이 `INFO`로 설정되어 있습니다. `DEBUG` 로그를 보려면 `tkadmin.yml`의 `debug` 옵션을 `true`로 변경해야 합니다.

### 시간대 필터

API 수준에서 `since`와 `until` 파라미터를 지원하여 특정 시간 범위의 로그만 조회할 수 있습니다:

| 파라미터 | 설명 |
|----------|------|
| `since` | 이 시각 이후의 로그만 조회 (실시간 폴링에 자동 사용) |
| `until` | 이 시각 이전의 로그만 조회 (과거 로그 로드에 자동 사용) |

### 검색어 필터

1. 상단 툴바의 **검색 입력 필드**에 검색어를 입력합니다.
2. **검색** 버튼을 클릭하거나 `Enter` 키를 누릅니다.
3. 대소문자를 **구분하지 않고** 로그 전체 내용에서 매칭되는 항목만 표시합니다.

### 검색어 하이라이팅

검색어와 일치하는 텍스트에는 **시각적 강조 효과**가 자동 적용됩니다. 이를 통해 방대한 로그 메시지에서 원하는 키워드를 빠르게 식별할 수 있습니다.



### 필터 조합

레벨 필터와 검색어 필터는 **동시에 적용**할 수 있습니다. 예를 들어:
- 레벨: `ERROR` + 검색어: `mariadb` -> MariaDB 관련 오류 로그만 표시

---

## 과거 로그 조회 (무한 스크롤)

### 동작 방식

1. 로그 테이블을 아래로 스크롤합니다.
2. **스크롤이 최하단에 도달**하면 (50px 이내) 자동으로 과거 로그를 요청합니다.
3. 현재 표시된 로그 중 가장 오래된 타임스탬프(`oldestTs`) 이전의 로그 100건을 추가 로드합니다.
4. 로드된 과거 로그는 테이블 하단에 추가됩니다.
5. 더 이상 로드할 로그가 없을 때까지 반복할 수 있습니다.

### 회전된 압축 로그 파일 지원

tkadmin의 로그 시스템(Lumberjack)은 로그 파일을 자동 회전(Rotate)하며, 오래된 파일은 GZIP으로 압축합니다:

| 항목 | 설정값 |
|------|--------|
| 파일당 최대 크기 | 10MB |
| 보관 백업 수 | 5개 |
| 보존 기간 | 30일 |
| 압축 형식 | GZIP (`.gz`) |

무한 스크롤 시 현재 활성 로그 파일의 데이터가 소진되면, **회전된 `.gz` 압축 파일**도 자동으로 스트림 해제하여 조회합니다. 이를 통해 과거 수일 ~ 수주 전의 로그까지 끊김 없이 탐색할 수 있습니다.

---

## 로그 상세 데이터 확장

각 로그 항목에 JSON 형태의 구조화된 추가 데이터(Fields)가 포함된 경우, 해당 행의 좌측에 **확장 토글 버튼**(▶)이 표시됩니다.



### 조회 방법

1. 확장 가능한 로그 행의 좌측 **▶** 버튼을 클릭합니다.
2. 행 아래에 Fields 데이터가 JSON 포맷으로 펼쳐집니다.
3. 다시 클릭하면 접힙니다.

Fields에는 다음과 같은 추가 정보가 포함될 수 있습니다:
- 오류 스택트레이스
- 요청 파라미터
- 서비스/모듈 식별 정보
- 성능 측정 데이터

---

## 성능

시스템 로그 뷰어는 대용량 로그 파일에서도 빠른 응답 속도를 보장하기 위해 다음과 같은 최적화가 적용되어 있습니다:

| 기법 | 설명 |
|------|------|
| **Seek + Tail** | 파일 끝에서부터 역방향으로 읽어 최신 로그를 우선 로드 (64KB 버퍼 단위) |
| **스트리밍 처리** | 전체 파일을 메모리에 로드하지 않고 청크 단위로 처리 |
| **조건부 조기 종료** | 시간대 필터(`since`) 조건 충족 시 나머지 파일 스캔을 즉시 중단 |
| **건수 제한** | 한 번의 요청당 최대 1,000건으로 제한하여 과도한 응답 방지 |

---

## 주의사항

!> **주의**: 로그 레벨을 `DEBUG`로 변경하면 로그 양이 대폭 증가하여 디스크 사용량이 빠르게 증가할 수 있습니다. 디버깅 완료 후 반드시 `INFO` 레벨로 복원하세요.

?> **팁**: 특정 시간대의 문제를 조사할 때는 레벨 필터(`ERROR`)와 검색어 필터를 조합하면 효율적입니다. 예를 들어, `ERROR` 레벨 + `timeout` 검색어로 타임아웃 관련 오류만 빠르게 추출할 수 있습니다.

---

## 관련 API

| API | 메서드 | 설명 |
|-----|--------|------|
| `/tkadmin/api/logs` | GET | 로그 조회 (필터링, 페이징 지원) |

### 쿼리 파라미터

| 파라미터 | 기본값 | 설명 |
|----------|--------|------|
| `limit` | 100 | 조회할 최대 로그 건수 (최대 1000) |
| `level` | (전체) | 로그 레벨 필터 (INFO, WARN, ERROR, DEBUG) |
| `search` | (없음) | 검색어 (대소문자 구분 없음) |
| `since` | (없음) | 이 시각 이후 로그만 조회 |
| `until` | (없음) | 이 시각 이전 로그만 조회 |

---

## 다음 단계

- [관리자 보고](07-report-viewer.md)에서 Watchdog 장애/복구 알림 이력을 확인하세요.
- [전문가 편집기](03-advanced-editor.md)에서 설정 변경 후 발생하는 로그를 모니터링하세요.
