# 전문가 편집기

## 개요

**전문가 편집기**는 TACHYON 솔루션 전반의 설정 파일을 웹 브라우저에서 직접 편집할 수 있는 고급 기능입니다. Microsoft의 오픈소스 코드 편집기인 **Monaco Editor**를 내장하여, VS Code에 준하는 편집 경험을 제공합니다.

tkadmin의 **자동 파일 탐색 엔진(Crawler)**이 `TargetDir` 하위 디렉토리를 스캔하여 발견한 설정 파일들을 좌측 파일 트리에 자동으로 표시하며, 운영자는 클릭 한 번으로 해당 파일을 열고 편집할 수 있습니다.

<!-- 스크린샷: 전문가 편집기 전체 화면 (좌측 파일 트리 + 우측 Monaco Editor) -->
![전문가 편집기 전체 화면](../../assets/images/user/03_advanced_editor_overview.png)

---

## 화면 구성

전문가 편집기는 크게 두 영역으로 나뉩니다:

| 영역 | 설명 |
|------|------|
| **좌측 - 파일 탐색기** | Crawler가 발견한 설정 파일 목록을 카테고리별로 표시 |
| **우측 - Monaco Editor** | 선택된 파일의 내용을 구문 하이라이팅과 함께 편집 |

---

## 파일 트리 탐색

### 자동 파일 탐색 엔진 (Crawler)

tkadmin은 `tkadmin.yml`에 정의된 `target_dir`(기본값: `/usr/local/TACHYON/TTS40/`) 하위를 재귀적으로 탐색하여 설정 파일을 자동으로 발견합니다.

### 지원 파일 형식

| 확장자 | 설명 |
|--------|------|
| `.yml` | YAML 설정 파일 |
| `.yml_dev` | YAML 개발/운영 오버라이드 파일 |
| `.properties` | Java Properties 형식 설정 |
| `.properties_dev` | Properties 개발/운영 오버라이드 파일 |
| `.json` | JSON 형식 설정 |
| `.conf` | NGINX 등 시스템 설정 파일 |

### 제외 폴더

다음 디렉토리는 탐색에서 자동 제외됩니다:

- `.git` - Git 저장소 메타데이터
- `node_modules` - Node.js 의존성
- `logs` - 로그 파일 디렉토리
- `temp` - 임시 파일 디렉토리
- `backup` - 백업 파일 디렉토리
- `dist` - 빌드 결과물 디렉토리

### 카테고리 분류

발견된 파일은 다음 기준에 따라 자동으로 분류됩니다:

| 카테고리 | 조건 | 예시 |
|----------|------|------|
| **GLOBAL** | `conf` 폴더 내부에 위치한 전역 설정 파일 | `conf/app_info.properties_dev` |
| **SERVICE** | 서비스 명칭이 포함된 개별 서비스 설정 | `dist/tachyon-server/application.yml_dev` |
| **SYSTEM** | `nginx` 등 시스템 관련 설정 | `nginx/tkadmin.conf` |

---

## 파일 열기 및 편집

### 파일 열기 순서

1. 좌측 **파일 탐색기**에서 편집할 파일을 클릭합니다.
2. 선택된 파일이 강조 표시되며, 우측 **Monaco Editor**에 파일 내용이 로드됩니다.
3. 상단 **에디터 툴바**에 현재 편집 중인 파일 경로와 **저장 (Ctrl+S)** 버튼이 표시됩니다.

<!-- 스크린샷: 파일 선택 후 편집 화면 -->
![파일 편집 화면](../../assets/images/user/03_advanced_editor_editing.png)

### 편집 기능

Monaco Editor는 다음과 같은 풍부한 편집 기능을 제공합니다:

| 기능 | 설명 |
|------|------|
| **구문 하이라이팅** | YAML, Properties, JSON, NGINX 설정 등 파일 확장자에 따라 자동 적용 |
| **코드 접기/펼치기** | 블록 단위로 코드를 접거나 펼쳐 가독성 향상 |
| **자동 완성** | 편집 중인 언어의 키워드 자동 제안 |
| **공백 문자 표시** | 들여쓰기 오류를 방지하기 위해 공백/탭 문자 시각적 표시 |

### 언어 자동 감지

파일 확장자에 따라 편집기 언어 모드가 자동 설정됩니다:

| 확장자 | 언어 모드 |
|--------|----------|
| `.yml`, `.yml_dev` | YAML |
| `.properties`, `.properties_dev` | Properties |
| `.json` | JSON |
| `.conf` | NGINX |
| 기타 | Plain Text |

### 단축키

| 단축키 | 동작 |
|--------|------|
| `Ctrl+S` (Windows/Linux) / `Cmd+S` (macOS) | 파일 저장 |

---

## 저장 프로세스

파일 저장 시 다음 단계가 자동으로 수행됩니다:

### 저장 순서

1. **저장 (Ctrl+S)** 버튼을 클릭하거나, `Ctrl+S` 단축키를 누릅니다.
2. (YAML 파일인 경우) 서버에서 **YAML 구문 유효성 검사**가 수행됩니다.
   - 문법 오류가 있으면 저장이 중단되고 오류 메시지가 모달로 표시됩니다.
3. 기존 파일이 **자동 백업**됩니다.
   - 백업 파일명 형식: `원본파일명.YYYYMMDDHHMMSS.bak`
   - 예시: `application.yml` -> `application.yml.20250615143022.bak`
4. 새 내용이 파일에 저장됩니다.
5. **감사 로그**에 변경 이력이 기록됩니다.
   - 기록 형식: `사용자 [GUID]가 설정 파일 '경로'을(를) 수정했습니다.`
6. 성공 알림 토스트가 표시됩니다: `설정이 저장되었습니다. (백업 생성됨)`

<!-- 스크린샷: 저장 성공 토스트 메시지 -->
![저장 성공 알림](../../assets/images/user/03_advanced_editor_save_success.png)

### YAML 구문 검증 실패 시

YAML 파일 저장 시 구문 오류가 발견되면:

1. 저장이 즉시 **중단**됩니다 (파일이 변경되지 않음).
2. 오류 모달에 상세 오류 메시지가 표시됩니다.
   - 예시: `YAML 문법 오류: yaml: line 15: did not find expected key`
3. 오류를 수정한 후 다시 저장을 시도합니다.

<!-- 스크린샷: YAML 문법 오류 모달 -->
![YAML 문법 오류](../../assets/images/user/03_advanced_editor_yaml_error.png)

---

## 보안

### Path Traversal 방지

전문가 편집기는 `TargetDir` 외부의 파일에 접근할 수 없도록 강력한 경로 보안 검증을 수행합니다:

- 상대 경로 탐색(`..`) 사용 차단
- 절대 경로(`/` 또는 `\`로 시작) 접근 차단
- 위반 시 HTTP 403 Forbidden 응답 반환

이를 통해 운영자가 실수로 또는 의도적으로 시스템 파일에 접근하는 것을 원천 차단합니다.

---

## 주의사항

!> **주의**: 설정 파일을 수정한 후에는 해당 서비스를 **재시작**해야 변경 내용이 적용됩니다. 서비스 재시작은 **서비스 관리** 메뉴에서 수행할 수 있습니다.

!> **주의**: YAML 파일의 들여쓰기(Indentation)는 반드시 **스페이스**를 사용해야 합니다. 탭 문자를 사용하면 구문 오류가 발생합니다. Monaco Editor에서 공백 문자가 점(.)으로 표시되므로 이를 참고하세요.

?> **팁**: 저장 시 자동 생성되는 `.bak` 백업 파일을 활용하면, 설정 변경 후 문제가 발생했을 때 이전 상태로 빠르게 원복할 수 있습니다.

?> **팁**: tkadmin은 폐쇄망(Air-gap) 환경을 지원합니다. Monaco Editor를 포함한 모든 외부 라이브러리가 바이너리에 내장되어 있어, 인터넷 연결 없이도 정상 동작합니다.

---

## 관련 API

| API | 메서드 | 설명 |
|-----|--------|------|
| `/tkadmin/api/config/external/files` | GET | Crawler가 발견한 설정 파일 목록 조회 |
| `/tkadmin/api/config/external/file?path=...` | GET | 특정 설정 파일 내용 조회 |
| `/tkadmin/api/config/external/file` | POST | 설정 파일 저장 (백업 + 검증 + 감사 로그 포함) |

---

## 다음 단계

- [서비스 관리](04-service-manager.md)에서 설정 변경 후 서비스를 재시작하세요.
- [시스템 로그](06-log-viewer.md)에서 변경 이력을 확인할 수 있습니다.
