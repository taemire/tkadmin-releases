# 내/외부 설정 편집기

## 개요

**내/외부 설정** 메뉴는 tkadmin의 핵심 설정 항목을 웹 UI에서 직접 편집할 수 있는 폼 기반 편집기입니다. 사이드바에서 **'내/외부 설정'** 메뉴를 클릭하면 접근할 수 있습니다.

이 화면에서 편집하는 설정은 `tkadmin.yml` 파일에 저장되며, 솔루션 이름, 네트워크 포트, 비상 접근 IP, 관리콘솔 통합 설정, 로깅 설정 등을 관리합니다.



---

## 설정 항목 상세

### 솔루션 이름

| 항목 | 내용 |
|------|------|
| **필드명** | 솔루션 이름 |
| **설명** | tkadmin이 관리하는 TACHYON 솔루션의 표시 이름 |
| **기본값** | `TACHYON Admin` |
| **영향 범위** | 대시보드 설정 요약 영역에 표시됨 |

---

### 네트워크 및 보안 설정

#### Listen 주소

| 항목 | 내용 |
|------|------|
| **필드명** | Listen 주소 |
| **설명** | tkadmin 서버가 바인딩할 네트워크 주소 |
| **기본값** | `0.0.0.0` (모든 인터페이스에서 수신) |

#### 포트

| 항목 | 내용 |
|------|------|
| **필드명** | 포트 |
| **설명** | tkadmin 메인 서비스의 리스닝 포트 |
| **기본값** | `13700` |
| **특이사항** | 변경 시 서비스 재시작이 필요합니다 |

포트 필드 옆에는 **'재시작 필요'** 태그가 노란색 뱃지로 표시되어, 이 값을 변경하면 서비스 재시작이 필요하다는 점을 시각적으로 안내합니다.



!> **주의**: 포트를 변경하면 NGINX 리버스 프록시 설정도 자동으로 동기화됩니다. 변경 후 서비스가 재시작되면 새 포트로 접속해야 합니다.

---

### 긴급 접속 허용 IP (Emergency IPs)



| 항목 | 내용 |
|------|------|
| **필드명** | 긴급 접속 허용 IP (Emergency IPs) |
| **설명** | 장애 시 인증을 우회하여 접근할 수 있는 IP 주소 목록 |
| **입력 형식** | 쉼표(`,`)로 구분하여 복수 IP 입력 |
| **예시** | `192.168.0.50, 10.0.0.99` |

이 IP 목록에 등록된 주소에서는 다음 권한이 부여됩니다:

- **메인 서비스**: TACHYON 인증 없이 `emergency-admin` 권한으로 자동 접근
- **Recovery 서비스**: Recovery 포트(`13701`) 접근 허용

#### 현재 IP 자동 추가 기능

필드 우측에 현재 접속 중인 클라이언트 IP가 표시되며, **'+'** 버튼을 클릭하면 해당 IP가 목록에 자동으로 추가됩니다.

1. 현재 IP가 우측에 파란색으로 표시됩니다 (예: `현재 IP: 192.168.1.100`).
2. **'+'** 아이콘 버튼을 클릭합니다.
3. IP가 입력 필드에 자동으로 추가되고, 성공 토스트 메시지가 표시됩니다.
4. 이미 목록에 포함된 IP인 경우, 중복 안내 메시지가 표시됩니다.

?> **팁**: IP 추가 시 클립보드에도 자동으로 복사되어, 다른 곳에 붙여넣기할 수 있습니다.

---

### 설치 경로 (Target Dir)

| 항목 | 내용 |
|------|------|
| **필드명** | 설치 경로 (Target Dir) |
| **설명** | TACHYON 솔루션이 설치된 루트 디렉토리 경로 |
| **기본값** | `/usr/local/TACHYON/TTS40/` |
| **영향 범위** | 환경 정보 크롤링, 디스크 사용량 계산, 전문가 편집기 파일 탐색 범위 |

---

### 관리콘솔 통합 설정

TACHYON 대시보드와의 통합 연동을 제어하는 설정입니다.



#### 링크 노출 여부 (show_link)

| 항목 | 내용 |
|------|------|
| **필드명** | TACHYON 대시보드에 tkadmin 링크 노출 |
| **타입** | 체크박스 (켜짐/꺼짐) |
| **기본값** | 꺼짐 (`false`) |
| **설명** | 활성화하면 TACHYON 대시보드의 사이드바와 시스템 설정 페이지에 tkadmin 접근 링크가 노출됩니다 |

?> **팁**: 이 설정은 인젝터 스크립트(`tkadmin_injector.js`)의 동작을 제어합니다. 비활성화해도 직접 URL 접근(`/tkadmin/`)은 가능합니다.

#### 접속 허용 관리자 ID (allowed_ids)

| 항목 | 내용 |
|------|------|
| **필드명** | 접속 허용 관리자 ID (Allowed IDs) |
| **설명** | tkadmin에 접근할 수 있는 TACHYON 통합 UI 계정 ID 목록 |
| **입력 형식** | 쉼표(`,`)로 구분하여 복수 ID 입력 |
| **기본값** | `tsadmin` |
| **예시** | `inca, admin, tsadmin` |

비워두면 모든 TACHYON 관리자가 tkadmin에 접속할 수 있습니다.

---

### 시스템 로깅 및 감사 로그 설정

tkadmin 자체의 로깅 정책을 설정합니다.

| 항목 | 설명 | 기본값 |
|------|------|--------|
| **로그 파일 경로** | 시스템 로그가 저장될 파일 경로 | `logs/tkadmin.log` |
| **로그 레벨** | 로깅 레벨 (Debug / Info / Warn / Error) | `Info` |
| **최대 파일 크기 (MB)** | 로그 파일 하나의 최대 크기, 초과 시 로테이션 | `10` MB |
| **보관 파일 개수** | 로테이션된 백업 파일의 최대 보관 개수 | `5` 개 |
| **보관 일수** | 로그 파일의 최대 보존 기간 | `30` 일 |

하단의 **감사 로그 (Audit DB)** 안내 영역에는 관리자 보고 및 장애 이력이 `app.db` 파일에 영구 보관된다는 안내가 표시됩니다.

---

## 설정 파일 위치

모든 설정은 다음 파일에 YAML 형식으로 저장됩니다:

```
/usr/local/TACHYON/TTS40/tkadmin.yml
```

설정 파일의 경로는 바이너리 실행 파일의 이름을 기반으로 자동 결정됩니다. 예를 들어 바이너리 이름이 `tkadmin`이면 같은 디렉토리의 `tkadmin.yml`이 설정 파일이 됩니다.

---

## 클라이언트 IP 표시 기능

내/외부 설정 화면에서는 현재 접속 중인 클라이언트의 IP 주소가 **'현재 IP'** 레이블과 함께 표시됩니다. 이 정보는 서버의 API 응답(`client_ip` 필드)에서 제공되며, 비상 접근 IP를 등록할 때 참고 용도로 활용됩니다.

---

## 저장 플로우

### 일반 저장 (포트 변경 없음)

1. 설정 항목을 수정합니다.
2. 하단의 **'설정 저장'** 버튼을 클릭합니다.
3. 서버에 설정이 저장되고, **'설정이 저장되었습니다.'** 토스트 메시지가 화면 상단에 표시됩니다.
4. 토스트 메시지는 3초 후 자동으로 사라집니다.
5. 설정 폼이 저장된 최신 값으로 자동 갱신됩니다.



### 포트 변경 시 저장

포트 값을 변경한 후 저장하면, 서비스 재시작이 필요하므로 추가 확인 절차가 진행됩니다.

1. 포트 값을 변경합니다 (예: `13700` -> `13800`).
2. **'설정 저장'** 버튼을 클릭합니다.
3. **확인 모달**이 표시됩니다:
   - 제목: **'서비스 재시작 필요'**
   - 메시지: *'포트 설정을 변경하면 서비스가 재시작됩니다. 저장하시겠습니까?'*
   - 버튼: **'취소'** / **'확인'**



4. **'확인'**을 클릭하면:
   - 설정이 저장됩니다.
   - NGINX 프록시 설정이 새 포트로 자동 동기화됩니다.
   - **'서비스 재시작 중...'** 토스트가 표시됩니다.
   - 서비스가 재시작되며, 약 3초 후 페이지가 자동으로 새로고침됩니다.

5. **'취소'**를 클릭하면:
   - **'저장이 취소되었습니다.'** 토스트가 표시됩니다.
   - 설정 폼이 원래 값으로 복원됩니다 (변경 전 상태로 되돌림).

### 저장 실패 시

서버에서 설정 저장에 실패하면, 에러 모달이 표시되며 실패 원인이 안내됩니다.

---

## 설정 취소

하단의 **'취소'** 버튼을 클릭하면, 수정한 내용이 모두 폐기되고 설정 폼이 서버에 저장된 원래 값으로 다시 로드됩니다.

---

## 조작 순서 요약

### 일반 설정 변경

1. 사이드바에서 **'내/외부 설정'** 메뉴를 클릭합니다.
2. 변경하고자 하는 설정 항목을 수정합니다.
3. **'설정 저장'** 버튼을 클릭합니다.
4. 성공 토스트 메시지를 확인합니다.

### 비상 접근 IP 추가

1. **'내/외부 설정'** 메뉴로 이동합니다.
2. '긴급 접속 허용 IP' 필드에서 현재 IP 옆의 **'+'** 버튼을 클릭합니다.
3. 또는 직접 IP를 쉼표로 구분하여 입력합니다.
4. **'설정 저장'** 버튼을 클릭합니다.

### 포트 변경

1. **'내/외부 설정'** 메뉴로 이동합니다.
2. '포트' 필드의 값을 변경합니다.
3. **'설정 저장'** 버튼을 클릭합니다.
4. 확인 모달에서 **'확인'**을 클릭합니다.
5. 서비스 재시작이 완료될 때까지 약 3초 대기합니다.
6. 페이지가 자동으로 새로고침되면, 새 포트로 정상 접속되었는지 확인합니다.

### 관리콘솔 통합 설정

1. **'내/외부 설정'** 메뉴로 이동합니다.
2. 'TACHYON 대시보드에 tkadmin 링크 노출' 체크박스를 켜거나 끕니다.
3. 필요 시 '접속 허용 관리자 ID' 목록을 수정합니다.
4. **'설정 저장'** 버튼을 클릭합니다.

---

## 다음 단계

- [대시보드](01-dashboard.md)로 돌아가 시스템 상태를 확인하세요.
