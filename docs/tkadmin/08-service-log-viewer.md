# 서비스 로그 뷰어

> **v0.2.3** — 멀티패널 서비스 실시간 파일 로그 모니터링 시스템

## 개요

서비스 로그 뷰어는 TACHYON 서비스별 파일 로그를 **멀티패널 UI**로 동시에 실시간 모니터링하는 기능입니다. 최대 **8개** 서비스를 동시에 열어 각각의 로그를 실시간으로 추적할 수 있습니다.

> ℹ️ **시스템 로그**가 tkadmin 자체 로그(journalctl 기반)를 표시하는 반면, **서비스 로그**는 TACHYON 각 서비스의 파일 로그를 직접 읽어 표시합니다.

## 화면 구성

### 도구 모음 (Toolbar)

화면 상단의 도구 모음에서 다음 작업을 수행할 수 있습니다:

| 항목 | 설명 |
|------|------|
| **서비스 추가** | 체크박스 팝오버에서 모니터링할 서비스를 다중 선택합니다 |
| **레이아웃 전환** | 그리드 / 수직 분할 / 수평 분할 모드를 전환합니다 |
| **전체 삭제** | 열린 모든 패널을 한 번에 닫습니다 |

### 서비스 추가 (체크박스 멀티셀렉트)

"서비스 추가" 버튼을 클릭하면 카테고리별 체크박스 팝오버가 나타납니다:

- **TACHYON 서비스**: Api, Auth, Manager, Report, Stat, Batch, Watchdog 등 동적 발견된 서비스
- **미들웨어**: Redis, Kafka, Zookeeper, OpenSearch, Logstash, Nginx

**사용 방법:**

1. "서비스 추가" 버튼 클릭 → 팝오버 열기
2. 원하는 서비스 체크박스 선택 (카테고리 전체 선택 가능)
3. "패널 추가" 버튼 클릭 → 선택한 서비스들의 패널이 일괄 생성

> 💡 이미 열려있는 서비스는 "열림" 뱃지가 표시되며 선택할 수 없습니다.

### 로그 패널

각 패널은 독립적으로 동작하며 다음 요소로 구성됩니다:

- **헤더 (Header)**: 드래그 핸들, 서비스 이름, 상태 표시(스트리밍/일시정지), 액션 버튼들
- **로그 영역 (Body)**: 로그 내용 표시 (레벨별 색상 구분)
- **상태 바 (Footer)**: 로그 줄 수, 버퍼 사용률, 스트리밍 상태, 파일 크기

## 주요 기능

### 1. 실시간 로그 스트리밍

각 패널은 **2초 간격**으로 새로운 로그를 자동으로 가져옵니다.

- 새 로그가 추가되면 자동으로 맨 아래로 스크롤됩니다
- 각 패널은 **최대 500줄**까지 캐시합니다 (초과 시 오래된 줄 제거)

### 2. 로그 레벨 표시

로그 레벨에 따라 자동으로 색상이 적용됩니다:

| 레벨 | 색상 | 설명 |
|------|------|------|
| **ERROR** | 빨간색 | 오류 메시지 |
| **WARN** | 노란색 | 경고 메시지 |
| **INFO** | 초록색 | 일반 정보 |
| **DEBUG** | 회색 | 디버깅 정보 |
| **FATAL** | 밝은 빨간색 | 치명적 오류 |

### 3. 로그 레벨 필터

패널 헤더의 **E / W / I / D** 토글 버튼으로 특정 레벨만 표시할 수 있습니다.

- 활성화된 레벨만 필터링되어 표시됩니다
- 필터 적용 시 상태 바에 `150/300줄` 형태로 표시(보이는 줄 / 전체 줄)
- 레벨이 감지되지 않는 줄(일반 텍스트)은 항상 표시됩니다

### 4. 레이아웃 모드 전환

도구 모음의 레이아웃 스위처로 3가지 배치 모드를 선택할 수 있습니다:

| 아이콘 | 레이아웃 | 설명 |
|--------|---------|------|
| **그리드** | Grid | 기본값. 패널 수에 따라 자동 격자 배치 |
| **수직** | Vertical | 세로 분할 (각 패널이 전체 높이, 좌우 배치) |
| **수평** | Horizontal | 가로 분할 (각 패널이 전체 너비, 상하 배치) |

**자동 그리드 레이아웃** (Grid 모드):

| 패널 수 | 레이아웃 |
|---------|---------|
| 1개 | 1열 (전체 폭) |
| 2개 | 2열 |
| 3~4개 | 2열 × 2행 |
| 5~8개 | 3열 |

### 5. 패널 드래그앤드롭 순서 변경

패널 헤더 좌측의 **드래그 핸들 아이콘(⋮)**을 잡고 드래그하여 패널 순서를 변경할 수 있습니다.

- 드래그 시 드롭 위치에 파란색 인디케이터 라인이 표시됩니다
- 드롭 시 부드러운 착지 애니메이션이 적용됩니다
- 최대화 상태에서는 드래그가 차단됩니다

### 6. 패널 최대화

패널 헤더의 **최대화 아이콘**을 클릭하면:

- 해당 패널이 **전체 화면**으로 확장됩니다
- 다른 패널과 도구 모음이 숨겨집니다
- **ESC** 키 또는 최소화 아이콘으로 원래 크기로 복원됩니다

### 7. 로그 다운로드

패널 헤더의 **다운로드 아이콘**을 클릭하면:

- 현재 패널에 캐시된 로그가 텍스트 파일로 저장됩니다
- 파일명 형식: `{서비스명}_{날짜시간}.log`

### 8. 검색 기능

패널 헤더의 **돋보기 아이콘**을 클릭하면:

- 검색 입력창이 나타납니다
- 입력한 키워드를 포함하는 줄만 필터링되어 표시됩니다
- 대소문자를 구분하지 않습니다

### 9. 일시 정지 / 재개

패널 헤더의 **일시정지 아이콘**을 클릭하면:

- 해당 패널의 실시간 스트리밍이 일시 정지됩니다
- 상태가 "일시정지" 로 변경됩니다
- 다시 클릭하면 스트리밍이 재개됩니다

### 10. 메모리 관리

각 패널은 **최대 500줄**의 로그를 버퍼에 유지합니다.

- 상태 바에 버퍼 사용률 인디케이터가 표시됩니다
- 버퍼가 **80%** 이상 차면 경고 색상으로 변경됩니다
- 버퍼가 가득 차면 오래된 줄부터 자동으로 제거됩니다

### 11. 팝아웃 (Pop-out)

패널 헤더의 **팝아웃 아이콘**을 클릭하면 해당 서비스의 로그가 **독립 브라우저 창**으로 분리됩니다.
- 멀티 모니터 환경에서 별도 화면에 특정 로그를 상시 배치할 수 있습니다.
- 팝아웃된 창도 원본 패널과 동일한 실시간 업데이트가 전송됩니다.

### 12. 세션 상태 유지 (State Persistence)

서비스 로그 뷰어의 모든 상태는 **sessionStorage**를 기반으로 브라우저 세션 동안 안전하게 유지됩니다.
- **유지 대상**: 열려있는 패널 목록, 패널별 순서, 선택된 레이아웃, 검색 필터링 상태.
- 브라우저를 새로고침하거나 다른 메뉴로 이동 후 복귀해도 이전의 모니터링 환경이 즉시 복원됩니다.

## 대시보드에서 바로 가기

**대시보드 → 서비스 로그** 섹션의 각 서비스 카드에 있는 **터미널 아이콘**을 클릭하면:

1. 자동으로 서비스 로그 화면으로 전환됩니다
2. 해당 서비스의 패널이 자동으로 생성되어 로그 스트리밍을 시작합니다

## 지원 서비스

서비스 로그 뷰어는 다음 카테고리의 서비스 로그를 지원합니다:

| 카테고리 | 서비스 예시 |
|----------|------------|
| **TACHYON 서비스** | Api, Auth, Manager, Report, Stat, Batch, Watchdog 등 |
| **미들웨어** | Redis, Kafka, Zookeeper, OpenSearch, Logstash, Nginx |

> ⚠️ 실제 서버에 로그 파일이 존재하는 서비스만 목록에 표시됩니다.

> ℹ️ tkadmin 자체 로그는 **시스템 로그** 메뉴에서 확인하세요.

## 비활성 탭 최적화

브라우저 탭이 숨겨지면 자동으로 모든 패널의 폴링이 중지됩니다:

- 탭 복귀 시 자동으로 스트리밍이 재개됩니다
- 오랜 시간 비활성 후 복귀 시 자동 일시정지 여부를 묻는 안내가 표시될 수 있습니다

## 팁

- 자주 확인하는 서비스는 패널을 열어둔 채로 최대화하면 편리합니다
- 에러만 모니터링하려면 **E** 버튼만 활성화하세요
- 체크박스 팝오버에서 카테고리 전체 선택으로 관련 서비스를 한 번에 추가하세요
- 드래그 핸들로 중요한 서비스 패널을 상단에 배치하세요
- 멀티 모니터 환경에서는 팝아웃으로 서비스별 로그를 별도 화면에 배치하세요
