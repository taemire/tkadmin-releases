# 환경 체크

## 개요

**환경 체크** 화면은 TACHYON 솔루션이 운영되는 리눅스 서버의 핵심 시스템 설정을 점검하고 조정할 수 있는 기능입니다. OS Limits, SELinux, 방화벽(Firewalld) 설정을 웹 인터페이스에서 직접 확인하고 변경할 수 있어, 터미널 접속 없이도 운영 환경을 관리할 수 있습니다.

<!-- 스크린샷: 환경 체크 전체 화면 -->
![환경 체크 화면](assets/images/user/05_env_check_overview.png)

!> **주의**: 환경 체크 기능은 **Linux 전용** 기능입니다. Windows 개발 환경에서는 더미(Mock) 데이터가 표시되며, 실제 시스템 변경은 수행되지 않습니다.

---

## 화면 구성

환경 체크 화면은 세 개의 카드로 구성됩니다:

| 영역 | 설명 |
|------|------|
| **OS Limits (limits.conf)** | 시스템 리소스 제한값 확인 및 설정 (화면 상단, 2열 너비) |
| **SELinux 설정** | SELinux 보안 정책 상태 확인 및 변경 |
| **방화벽 허용 정책** | Firewalld 포트/서비스 허용 관리 |

우측 상단의 **데이터 새로고침** 버튼을 클릭하면 모든 영역의 데이터를 최신 상태로 갱신할 수 있습니다.

---

## OS Limits 확인 및 설정

### 현재 설정 확인

`/etc/security/limits.conf` 파일에 정의된 현재 시스템 리소스 제한값이 테이블 형태로 표시됩니다.

<!-- 스크린샷: OS Limits 테이블 -->
![OS Limits 설정](assets/images/user/05_env_check_limits.png)

| 컬럼 | 설명 | 예시 |
|------|------|------|
| **Domain** | 적용 대상 (사용자/그룹) | `*` (모든 사용자), `root` |
| **Type** | 제한 유형 | `soft` (경고 한계), `hard` (절대 한계) |
| **Item** | 제한 항목 | `nofile` (파일 열기 수), `nproc` (프로세스 수) |
| **Value** | 제한값 | `65535` |

### 새 리미트 추가

테이블 하단의 입력 폼을 사용하여 새로운 리미트를 추가할 수 있습니다:

1. **Domain** 필드에 적용 대상을 입력합니다 (기본값: `*`).
2. **Type** 드롭다운에서 `soft` 또는 `hard`를 선택합니다.
3. **Item** 필드에 제한 항목을 입력합니다 (기본값: `nofile`).
4. **Value** 필드에 제한값을 입력합니다 (기본값: `65535`).
5. **항목 추가** 버튼을 클릭합니다.
6. 성공 시 토스트 메시지가 표시되고, 테이블이 자동 갱신됩니다.

**자주 사용되는 설정 예시:**

```
*    soft    nofile    65535
*    hard    nofile    65535
*    soft    nproc     65535
*    hard    nproc     65535
```

?> **팁**: TACHYON 솔루션은 대량의 파일 디스크립터를 사용하므로, `nofile` 값을 `65535` 이상으로 설정하는 것을 권장합니다. tkadmin의 systemd 서비스 유닛에는 `LimitNOFILE=65535`가 기본 포함되어 있습니다.

---

## SELinux 상태 제어

### 현재 상태 확인

SELinux의 현재 실행 상태와 부팅 설정이 표시됩니다:

- **현재 상태**: 실시간 적용 중인 SELinux 모드
- **부팅 설정**: `/etc/selinux/config`에 설정된 부팅 시 적용 모드

<!-- 스크린샷: SELinux 설정 카드 -->
![SELinux 설정](assets/images/user/05_env_check_selinux.png)

| 상태 | 표시 색상 | 설명 |
|------|----------|------|
| **Enforcing** | 초록색 | SELinux 정책을 강제 적용 |
| **Permissive** | 노란색 | 정책 위반을 로그에만 기록하고 차단하지 않음 |
| **Disabled** | 빨간색 | SELinux가 비활성화된 상태 |

### 모드 변경

세 개의 버튼 중 원하는 모드를 클릭하여 SELinux 상태를 변경할 수 있습니다:

1. 변경할 모드 버튼(**Enforcing**, **Permissive**, **Disabled**)을 클릭합니다.
2. 확인 팝업이 표시됩니다: `SELinux 모드를 [모드명] (으)로 변경하시겠습니까?`
3. **확인**을 클릭하면 변경이 수행됩니다.
4. 변경 성공 시 토스트 메시지가 표시되고 화면이 갱신됩니다.

**적용 방식:**
- **즉시 적용**: `setenforce` 명령으로 현재 세션에 즉시 반영
- **영구 반영**: `/etc/selinux/config` 파일을 수정하여 재부팅 후에도 유지

!> **주의**: `Disabled` 모드로 변경하면 전역 설정 파일(`/etc/selinux/config`)이 수정됩니다. 일부 환경에서는 완전한 비활성화를 위해 **시스템 재부팅**이 필요할 수 있습니다.

?> **팁**: TACHYON 솔루션 운영 시 SELinux로 인한 권한 문제가 발생하면, 먼저 `Permissive` 모드로 변경하여 로그를 확인한 후 적절한 정책을 추가하는 것을 권장합니다.

---

## 방화벽(Firewalld) 포트 관리

### 현재 상태 확인

Firewalld의 활성화 여부와 현재 허용된 포트/서비스 목록이 표시됩니다:

- **활성화 상태**: Firewalld 구동 여부 (초록색 체크 아이콘 또는 비활성 안내)
- **허용 포트 목록**: 태그(Tag) 형태로 현재 열린 포트/서비스 표시

<!-- 스크린샷: 방화벽 허용 정책 카드 -->
![방화벽 설정](assets/images/user/05_env_check_firewall.png)

### 포트 추가

1. **유형 선택**: `Port` 또는 `Service` 중 선택합니다.
   - **Port**: 특정 포트/프로토콜 (예: `8080/tcp`, `443/tcp`)
   - **Service**: 사전 정의된 서비스명 (예: `http`, `https`)
2. 입력 필드에 포트 번호(프로토콜 포함) 또는 서비스명을 입력합니다.
3. **정책 허용 추가** 버튼을 클릭합니다.
4. 성공 시 토스트 메시지가 표시되고 포트 목록이 갱신됩니다.

### 포트 제거

1. 허용 포트 목록에서 제거할 포트 태그 옆의 **X** 아이콘을 클릭합니다.
2. 확인 팝업이 표시됩니다: `포트 [포트명] 허용 정책을 삭제하시겠습니까?`
3. **확인**을 클릭하면 해당 포트 허용 정책이 제거됩니다.
4. 성공 시 토스트 메시지가 표시되고 목록이 갱신됩니다.

**TACHYON 솔루션 필수 포트 예시:**

| 포트 | 용도 |
|------|------|
| `443/tcp` | HTTPS (NGINX) |
| `13700/tcp` | tkadmin 메인 서비스 |
| `13701/tcp` | tkadmin Recovery 서비스 |
| `3306/tcp` | MariaDB |
| `6379/tcp` | Redis |
| `9092/tcp` | Kafka |
| `9200/tcp` | OpenSearch |

---

## 주의사항

!> **주의**: OS Limits, SELinux, 방화벽 설정 변경은 시스템 전체에 영향을 미칩니다. 변경 전 현재 설정을 반드시 확인하고, 운영 환경에서는 유지보수 시간에 수행할 것을 권장합니다.

!> **주의**: 방화벽에서 tkadmin 포트(`13700/tcp`)를 제거하면, 외부에서 웹 인터페이스에 접근할 수 없게 됩니다. 포트 제거 시 영향을 반드시 사전에 검토하세요.

?> **팁**: 환경 체크 화면의 데이터가 최신이 아닌 것 같다면, 우측 상단의 **데이터 새로고침** 버튼을 클릭하여 서버에서 최신 정보를 다시 조회하세요.

---

## 관련 API

| API | 메서드 | 설명 |
|-----|--------|------|
| `/tkadmin/api/system/os-checks` | GET | OS Limits, SELinux, 방화벽 통합 상태 조회 |
| `/tkadmin/api/system/os-checks/limits` | POST | OS Limit 항목 추가 |
| `/tkadmin/api/system/os-checks/selinux` | POST | SELinux 모드 변경 |
| `/tkadmin/api/system/os-checks/firewall` | POST | 방화벽 포트 추가/제거 |

---

## 다음 단계

- [시스템 로그](06-log-viewer.md)에서 시스템 로그를 실시간으로 모니터링하세요.
- [서비스 관리](04-service-manager.md)에서 서비스 상태를 확인하세요.
